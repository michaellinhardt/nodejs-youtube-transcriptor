# Implementation Plan: 1.1 - Initialize npm Package Structure

**Date:** 2025-11-18
**Task:** 1.1 - Initialize npm package structure
**Status:** Ready for Implementation
**Requirements:** TR-1 (Module Structure), TR-18 (CLI Entry Point), TR-19 (Setup Operations)

## Plan Overview

This plan establishes the foundation for the Transcriptor CLI tool by configuring package.json as a globally-installable npm package with proper CLI entry point configuration. The implementation focuses on setting up the package metadata, bin configuration for command-line access, and ensuring the project can be linked globally for development. This is the critical first step that enables all subsequent development work, as it establishes how users will invoke the tool and how Node.js will locate and execute the application.

## High-Level Steps

1. Configure package.json with complete metadata and dependencies
2. Set up bin/transcriptor as the CLI entry point
3. Verify npm link functionality for global package access

## Detailed Implementation

### Step 1: Configure package.json with Dependencies and Metadata

#### A. Rationale & Objective
The package.json file serves as the project's manifest, defining how npm manages dependencies, scripts, and package distribution. Proper configuration is essential for enabling global CLI installation via npm link and ensuring all required libraries are available for development.

#### B. Core Concepts & Strategy

The configuration strategy follows npm best practices for CLI tools:
- Define the package as a CLI tool using the `bin` field
- Specify exact dependency versions from TR requirements
- Include installation scripts that automatically link the package globally
- Set proper metadata for repository, licensing, and discoverability

**Key Configuration Sections:**

1. **bin field**: Maps the `transcriptor` command to the executable entry point
2. **dependencies**: Declares runtime requirements (commander, axios, fs-extra, dotenv)
3. **scripts**: Provides convenience commands for installation and cleanup
4. **metadata**: Ensures proper identification and attribution

#### C. Implementation Guidelines

**Key Configuration:**

```json
{
  "name": "nodejs-youtube-transcriptor",
  "version": "1.0.0",
  "description": "CLI tool for extracting and managing YouTube video transcripts",
  "main": "src/index.js",
  "bin": {
    "transcriptor": "./bin/transcriptor"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "install": "npm link",
    "uninstall": "npm unlink nodejs-youtube-transcriptor"
  },
  "dependencies": {
    "commander": "^12.0.0",
    "axios": "^1.7.0",
    "fs-extra": "^11.0.0",
    "dotenv": "^16.0.0"
  },
  "repository": {
    "type": "git",
    "url": "git+https://github.com/michaellinhardt/nodejs-youtube-transcriptor.git"
  },
  "keywords": [
    "cli",
    "transcriptor",
    "youtube",
    "transcript",
    "captions"
  ],
  "author": "michaellinhardt",
  "license": "MIT",
  "engines": {
    "node": ">=18.0.0"
  }
}
```

**Critical Points:**

- The `bin` field must point to `./bin/transcriptor` (not `./src/index.js`) to follow standard CLI tool conventions
- Use exact version constraints with caret (^) to allow patch and minor updates
- The `install` script with `npm link` enables global command access during development
- Node.js version constraint (>=18.0.0) matches TR requirement for v18+

#### D. Success Criteria

- [ ] package.json contains all four required dependencies with correct versions
- [ ] bin field correctly maps "transcriptor" command to entry point
- [ ] Package metadata includes description, keywords, and repository information
- [ ] Node.js version constraint is set to >=18.0.0

#### E. Dependencies & Inputs

- Requires: Existing package.json file (currently present)
- Produces: Complete package.json ready for dependency installation

---

### Step 2: Create bin/transcriptor CLI Entry Point

#### A. Rationale & Objective
The bin/transcriptor file serves as the executable entry point for the CLI tool. This file must have proper Unix shebang, executable permissions, and delegate to the main application logic in src/index.js. Separating the bin entry point from application logic follows best practices for CLI tools and enables cleaner testing and maintenance.

#### B. Core Concepts & Strategy

CLI entry points in Node.js follow a standard pattern:
1. **Shebang declaration**: `#!/usr/bin/env node` tells the OS to execute with Node.js
2. **Minimal logic**: The bin file should only bootstrap the application
3. **Delegation**: Actual command routing happens in src/index.js
4. **Executable permissions**: The file must have +x permissions for direct execution

**Architecture Decision:**
- bin/transcriptor → minimal bootstrap
- src/index.js → command routing and CLI framework (commander.js)
- src/commands/ → actual command implementations

This separation enables:
- Testing command logic without invoking the binary
- Cleaner code organization
- Standard npm package structure

#### C. Implementation Guidelines

**Key Logic:**

```javascript
#!/usr/bin/env node

// Bootstrap the CLI application
// All command routing and logic lives in src/index.js
require('../src/index.js');
```

**File Creation Steps:**

1. Create `bin/` directory in project root
2. Create `bin/transcriptor` file with shebang and require statement
3. Set executable permissions: `chmod +x bin/transcriptor`
4. Update src/index.js to contain commander.js routing (part of task 2.3)

**Critical Points:**

- The shebang MUST be the first line with no preceding whitespace
- Use relative path `../src/index.js` to locate the main entry point
- File must not have .js extension (CLI commands are typically extension-less)
- Executable permissions are required for direct invocation
- The file should be committed with executable permissions in git

#### D. Success Criteria

- [ ] bin/ directory exists in project root
- [ ] bin/transcriptor file contains proper shebang (#!/usr/bin/env node)
- [ ] File has executable permissions (chmod +x)
- [ ] File requires/imports src/index.js
- [ ] No .js extension on the bin/transcriptor filename

#### E. Dependencies & Inputs

- Requires: src/index.js file (exists, will be updated in task 2.3)
- Produces: Executable bin/transcriptor entry point

---

### Step 3: Install Dependencies and Verify npm link

#### A. Rationale & Objective
Installing dependencies makes the required libraries available for development, while verifying npm link ensures the global command installation works correctly. This validation step confirms users can run `transcriptor` from any directory once the package is installed.

#### B. Core Concepts & Strategy

**npm link workflow:**
1. Creates a symlink from global node_modules to the local package
2. Links the bin command to global bin directory
3. Enables running `transcriptor` command from any directory
4. Changes to local files immediately reflect in global command (no reinstall needed)

**Verification strategy:**
- Run `npm install` to fetch dependencies
- Run `npm link` to create global links
- Test command invocation from different directory
- Verify Node.js can locate and execute the entry point

#### C. Implementation Guidelines

**Key Commands:**

```bash
# Install dependencies from package.json
npm install

# Create global symlink for development
npm link

# Verify the command is available globally
which transcriptor
# Expected output: /usr/local/bin/transcriptor or similar

# Test command execution from any directory
cd /tmp
transcriptor
# Expected output: "hello i'm transcriptor" (current placeholder)

# Verify dependencies installed
ls node_modules
# Should show: commander, axios, fs-extra, dotenv
```

**Verification Checklist:**

```bash
# 1. Check package linked globally
npm list -g --depth=0 | grep nodejs-youtube-transcriptor

# 2. Verify bin symlink created
ls -l $(which transcriptor)
# Should show symlink to your project

# 3. Test execution returns expected output
transcriptor 2>&1
```

**Critical Points:**

- `npm install` must complete without errors before running `npm link`
- The global link points to your local development directory
- Changes to src/index.js take effect immediately (no re-link needed)
- If command not found, check PATH includes npm global bin directory
- Use `npm unlink nodejs-youtube-transcriptor` to remove global link

#### D. Success Criteria

- [ ] node_modules/ directory contains all four dependencies
- [ ] package-lock.json created with locked versions
- [ ] `which transcriptor` returns a valid path
- [ ] Running `transcriptor` from any directory executes bin/transcriptor
- [ ] Current placeholder output appears when running command

#### E. Dependencies & Inputs

- Requires: Completed package.json (Step 1) and bin/transcriptor (Step 2)
- Produces: Installed dependencies, globally-accessible transcriptor command

---

## Task Breakdown Updates

### Current Subtasks Status

The existing subtasks in tasks.md accurately reflect this implementation:

- [ ] 1.1.1 Create package.json with global CLI configuration ✓ (Step 1)
- [ ] 1.1.2 Set up bin/transcriptor entry point ✓ (Step 2)
- [ ] 1.1.3 Configure package for npm link usage ✓ (Step 3)

No additional subtasks needed. The plan comprehensively covers all three subtasks.

---

## Technical Considerations

### Architecture Impact

This implementation establishes the foundational architecture for the entire CLI tool:

- **Entry Point Chain**: bin/transcriptor → src/index.js → command handlers
- **Global Availability**: Package becomes accessible system-wide via npm link
- **Development Workflow**: Changes to source files immediately available without reinstallation
- **Dependency Foundation**: Makes commander.js, axios, fs-extra, and dotenv available for subsequent tasks

### Integration Points

**npm Ecosystem:**
- Integrates with npm's global package management
- Uses standard bin/ convention for CLI tools
- Follows semantic versioning for dependency management

**Node.js Runtime:**
- Shebang enables OS to invoke Node.js interpreter
- Requires Node.js v18+ per technical requirements
- Module loading via require/import in subsequent development

**File System:**
- Global symlink in system bin directory
- Local symlink in global node_modules
- Development files remain in project directory

### Risk Mitigation

| Risk | Likelihood | Impact | Mitigation Strategy |
|------|------------|--------|---------------------|
| Dependency version conflicts | Low | Medium | Use exact versions from TR requirements; lock with package-lock.json |
| npm link fails due to permissions | Medium | High | Document sudo usage if needed; provide troubleshooting steps |
| Command name collision | Low | Medium | Use unique name "transcriptor"; verify not already in use |
| Node.js version incompatibility | Low | High | Set engines field to enforce v18+; document version requirement |

### Performance Considerations

- **Startup time**: Minimal impact at this stage (just loading Node.js and required modules)
- **Installation size**: ~5-10MB for dependencies (commander, axios, fs-extra, dotenv)
- **Global pollution**: Single command added to PATH
- **Memory footprint**: Negligible when not running; ~20-30MB when active

---

## Testing Strategy

### Manual Testing

Since task 9.0 (Testing Implementation) is not yet reached, validation will be manual:

**Dependency Validation:**
```bash
# Verify all dependencies installed with correct versions
npm list --depth=0
# Should show:
# ├── axios@1.7.x
# ├── commander@12.0.x
# ├── dotenv@16.0.x
# └── fs-extra@11.0.x
```

**CLI Execution Testing:**
```bash
# Test from project directory
./bin/transcriptor
# Expected: "hello i'm transcriptor"

# Test from different directory
cd /tmp && transcriptor
# Expected: "hello i'm transcriptor"

# Test command location
which transcriptor
# Expected: Path to global bin or node_modules
```

**Link Integrity Testing:**
```bash
# Verify symlink points to project
ls -l $(which transcriptor)
# Should show: transcriptor -> /path/to/project/bin/transcriptor
```

### Edge Cases

- **Already linked package**: Running `npm link` again should be idempotent
- **Missing bin/transcriptor**: npm link will fail; verify file exists first
- **Non-executable permissions**: Command will fail; verify chmod +x was applied
- **PATH not including npm global bin**: Command not found; document PATH setup

---

## Implementation Notes

### Code Organization

```
nodejs-youtube-transcriptor/
├── bin/
│   └── transcriptor          # CLI entry point (new)
├── src/
│   └── index.js              # Command router (update in task 2.3)
├── package.json              # Updated with dependencies and bin config
├── package-lock.json         # Generated by npm install (new)
└── node_modules/             # Dependencies (new)
    ├── axios/
    ├── commander/
    ├── dotenv/
    └── fs-extra/
```

### Coding Standards

**package.json:**
- Use 2-space indentation (standard JSON formatting)
- Alphabetize dependencies for maintainability
- Include helpful scripts (install, uninstall)
- Set explicit engines constraint

**bin/transcriptor:**
- Shebang on line 1, no exceptions
- Minimal logic (just bootstrap)
- Use relative path for src/index.js
- Add brief comment explaining purpose

**File Permissions:**
- bin/transcriptor: 755 (rwxr-xr-x)
- src/index.js: 644 (rw-r--r--)
- Commit with proper permissions

### Documentation Requirements

**Inline Comments:**
- Add comment in bin/transcriptor explaining its role
- Document the require/import of src/index.js

**README Updates (future task 10.1):**
- Document npm link installation process
- Explain how to unlink for cleanup
- Note Node.js version requirement

**Commit Message:**
- Clear, atomic commit for task 1.1
- Reference task number in message

---

## Critical Issue: API Endpoint Discrepancy

**IMPORTANT DISCOVERY:**

There is a critical discrepancy between technical requirements and actual API documentation:

**Technical Requirements (TR)** specify:
```yaml
Endpoint: POST https://api.scrape-creators.com/transcript
```

**Actual API Documentation** shows:
```yaml
Endpoint: GET https://api.scrapecreators.com/v1/youtube/video/transcript
```

**Differences:**
1. HTTP Method: POST vs GET
2. Domain: scrape-creators.com vs scrapecreators.com (hyphen vs no hyphen)
3. Path structure: /transcript vs /v1/youtube/video/transcript
4. API version: No version vs v1

**Impact:**
- Task 4.0 (API Integration Layer) will need to use the actual API endpoint from documentation
- The TR requirements need to be updated to reflect reality
- This must be corrected before implementing task 4.1

**Recommendation:**
- Update requirements_technical.md after task 1.1 completion
- Use GET method and correct endpoint structure in API client implementation
- Verify API documentation is current before task 4.0 begins

---

## Estimated Effort

| Component | Effort | Complexity |
|-----------|--------|------------|
| Update package.json with dependencies | 0.5 hours | Low |
| Create bin/transcriptor entry point | 0.5 hours | Low |
| Install dependencies and verify npm link | 1 hour | Low |
| Testing and validation | 0.5 hours | Low |
| Documentation updates | 0.5 hours | Low |
| **Total** | 3 hours | Overall: Low |

**Complexity Justification:**
- Low complexity: Standard npm package configuration
- No custom logic required
- Well-documented npm conventions
- Straightforward verification steps

---

## Next Steps

1. **Execute Step 1**: Update package.json with dependencies and configuration
2. **Execute Step 2**: Create bin/transcriptor with proper shebang and permissions
3. **Execute Step 3**: Run npm install and npm link, verify command works
4. **Validate**: Test command execution from multiple directories
5. **Update tasks.md**: Mark subtasks 1.1.1, 1.1.2, 1.1.3 as completed [x]
6. **Commit changes**: Create atomic commit for task 1.1
7. **Address API discrepancy**: Update TR requirements before task 4.0
8. **Proceed to task 1.2**: Install and configure dependencies (already done via this task)

**Note on task 1.2**: Task 1.2 in tasks.md lists installing dependencies individually. Since Step 3 of this plan installs all dependencies at once, task 1.2 will be effectively completed when task 1.1 is done. Update tasks.md to reflect this.

---

## References

- **Functional Requirements**: FR-8 (Command Interface), FR-9 (Registry Operations)
- **Technical Requirements**: TR-1 (Main Command), TR-10 (Cross-Platform Paths), TR-11 (API Key Management), TR-18 (CLI Entry Point), TR-19 (Setup Operations)
- **Related Tasks**:
  - Completes: 1.1, 1.1.1, 1.1.2, 1.1.3
  - Enables: 1.2 (dependencies already installed), 1.3 (project structure), 2.3 (CLI framework)
- **External Documentation**:
  - npm CLI documentation: https://docs.npmjs.com/cli/v9/commands/npm-link
  - npm package.json spec: https://docs.npmjs.com/cli/v9/configuring-npm/package-json
  - Scrape Creators API: docs/scrapecreators/route_youtube_transcript.md
